<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Configurador Óculos">
    <meta name="theme-color" content="#1a365d">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iNDAiIGZpbGw9IiMxYTM2NWQiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8cGF0aCBkPSJNMiAxMmMwIDEuMDI1IDQuMzM2IDEuODc3IDkuNjgyIDEuODc3UzIxLjM2NCAxMy4wMjUgMjEuMzY0IDEyYzAtMS4wMjUtNC4zMzYtMS44NzctOS42ODItMS44NzdTMiAxMC45NzUgMiAxMnoiLz4KPHN2ZyB4PSI1NiIgeT0iNTYiIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8Y2lyY2xlIGN4PSI2IiBjeT0iMTIiIHI9IjQiLz4KPHN2ZyB4PSI2NCIgeT0iNjQiIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8Y2lyY2xlIGN4PSIxOCIgY3k9IjEyIiByPSI0Ii8+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+Cjwvc3ZnPg==">
    <title>Configurador de Óculos - iPhone</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f3a 25%, #2d3561 50%, #007AFF 75%, #5AC8FA 100%);
            background-size: 400% 400%;
            animation: gradientFlow 12s ease infinite;
            color: white;
            min-height: 100vh;
            padding: env(safe-area-inset-top, 20px) env(safe-area-inset-right, 20px) env(safe-area-inset-bottom, 20px) env(safe-area-inset-left, 20px);
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            overflow-x: hidden;
        }
        
        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at top left, rgba(0, 122, 255, 0.15) 0%, transparent 60%),
                radial-gradient(ellipse at bottom right, rgba(90, 200, 250, 0.15) 0%, transparent 60%),
                radial-gradient(ellipse at center, rgba(0, 122, 255, 0.05) 0%, transparent 80%);
            pointer-events: none;
            z-index: -1;
        }
        
        .container { 
            max-width: 400px; 
            margin: 0 auto; 
            padding-bottom: env(safe-area-inset-bottom, 0px);
            position: relative;
            z-index: 1;
        }
        
        .card { 
            background: linear-gradient(145deg, rgba(255,255,255,0.18), rgba(255,255,255,0.08));
            border-radius: 24px; 
            padding: 28px; 
            margin: 18px 0;
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255,255,255,0.25);
            box-shadow: 
                0 30px 60px rgba(0,0,0,0.4),
                0 12px 25px rgba(0, 122, 255, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.4),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.15) 50%, transparent 70%);
            border-radius: 24px;
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }
        
        .card:hover {
            transform: translateY(-10px) rotateX(3deg) scale(1.02);
            box-shadow: 
                0 40px 80px rgba(0,0,0,0.5),
                0 18px 35px rgba(0, 122, 255, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.5),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        
        .card:hover::before {
            opacity: 1;
        }
        
        .btn { 
            background: linear-gradient(145deg, #007AFF, #0056CC, #003D99);
            color: white; 
            border: none; 
            padding: 18px 28px; 
            border-radius: 16px; 
            cursor: pointer; 
            font-size: 17px;
            font-weight: 700;
            width: 100%;
            margin: 10px 0;
            box-shadow: 
                0 10px 30px rgba(0, 122, 255, 0.4),
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.3),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            -webkit-appearance: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }
        
        .btn:active { 
            transform: translateY(-2px) rotateX(8deg) scale(0.98);
            box-shadow: 
                0 15px 40px rgba(0, 122, 255, 0.5),
                0 8px 20px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.4),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        
        .btn:active::before {
            left: 100%;
        }
        
        .btn-outline {
            background: linear-gradient(145deg, transparent, rgba(0, 122, 255, 0.15));
            border: 2px solid #007AFF;
            color: #5AC8FA;
            box-shadow: 
                0 10px 30px rgba(0, 122, 255, 0.2),
                0 5px 15px rgba(0,0,0,0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }
        
        .btn-outline:active {
            background: linear-gradient(145deg, #007AFF, rgba(0, 122, 255, 0.8));
            color: white;
            border-color: #5AC8FA;
        }
        
        .hidden { display: none; }
        
        .progress-bar {
            background: linear-gradient(145deg, rgba(255,255,255,0.15), rgba(0,0,0,0.2));
            height: 10px;
            border-radius: 12px;
            overflow: hidden;
            margin: 24px 0;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.3);
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #007AFF, #5AC8FA, #7dd3fc);
            height: 100%;
            transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 122, 255, 0.6);
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShimmer 2.5s infinite;
        }
        
        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .lens-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 24px;
            margin: 16px 0;
            border-left: 6px solid #007AFF;
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.3),
                0 8px 20px rgba(0, 122, 255, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
            position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }
        
        .lens-card:hover {
            transform: translateY(-6px) rotateX(4deg);
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.4),
                0 12px 25px rgba(0, 122, 255, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.4);
        }
        
        .price { 
            font-size: 24px; 
            font-weight: 800; 
            color: #5AC8FA; 
            margin: 12px 0;
            text-shadow: 0 4px 12px rgba(90, 200, 250, 0.5);
            position: relative;
        }
        
        .features {
            display: flex;
            gap: 10px;
            margin: 16px 0;
            flex-wrap: wrap;
        }
        
        .feature {
            background: linear-gradient(145deg, rgba(0, 122, 255, 0.35), rgba(0, 122, 255, 0.15));
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(0, 122, 255, 0.4);
            box-shadow: 
                0 6px 15px rgba(0, 122, 255, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }
        
        .feature:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 20px rgba(0, 122, 255, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.4);
        }
        
        .editor-input {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.3);
            background: linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08));
            color: white;
            margin: 10px 0;
            font-size: 16px;
            box-shadow: 
                inset 0 2px 6px rgba(0,0,0,0.2),
                0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }
        
        .editor-input:focus {
            outline: none;
            border-color: #5AC8FA;
            box-shadow: 
                inset 0 2px 6px rgba(0,0,0,0.2),
                0 0 0 4px rgba(90, 200, 250, 0.2),
                0 6px 16px rgba(90, 200, 250, 0.3);
        }
        
        .editor-input::placeholder { 
            color: rgba(255,255,255,0.5); 
        }
        
        select.editor-input {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2'%3e%3cpolyline points='6,9 12,15 18,9'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 22px;
        }
        
        select.editor-input option {
            background: #0a0e1a;
            color: white;
        }
        
        textarea.editor-input {
            resize: vertical;
            min-height: 70px;
            font-family: inherit;
        }
        
        .install-guide {
            background: linear-gradient(145deg, rgba(0, 122, 255, 0.2), rgba(0, 122, 255, 0.1));
            border: 1px solid rgba(0, 122, 255, 0.4);
            border-radius: 20px;
            padding: 24px;
            margin: 24px 0;
            text-align: center;
            box-shadow: 
                0 15px 35px rgba(0, 122, 255, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }
        
        .install-icon {
            font-size: 52px;
            margin-bottom: 16px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        
        h1 { 
            text-align: center; 
            font-size: 34px; 
            font-weight: 800; 
            margin-bottom: 12px;
            background: linear-gradient(135deg, #5AC8FA, #007AFF, #003D99);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 6px 12px rgba(0, 122, 255, 0.3);
        }
        
        h2 { 
            text-align: center; 
            font-size: 26px; 
            font-weight: 700; 
            margin-bottom: 24px; 
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        h3 {
            text-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        
        .back-btn {
            position: sticky;
            top: env(safe-area-inset-top, 20px);
            z-index: 100;
            margin-bottom: 24px;
        }
        
        /* Efeito de brilho para preços */
        @keyframes priceGlow {
            0%, 100% { text-shadow: 0 4px 12px rgba(90, 200, 250, 0.5); }
            50% { text-shadow: 0 6px 20px rgba(90, 200, 250, 0.8); }
        }
        
        .price {
            animation: priceGlow 4s ease-in-out infinite;
        }
        
        /* Partículas flutuantes de fundo */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(90, 200, 250, 0.1) 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, rgba(0, 122, 255, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 50% 50%, rgba(90, 200, 250, 0.05) 1px, transparent 1px);
            background-size: 180px 180px, 220px 220px, 160px 160px;
            animation: floatParticles 25s linear infinite;
            pointer-events: none;
            z-index: -1;
        }
        
        @keyframes floatParticles {
            0% { transform: translateY(0px) translateX(0px) rotate(0deg); }
            33% { transform: translateY(-15px) translateX(8px) rotate(120deg); }
            66% { transform: translateY(8px) translateX(-6px) rotate(240deg); }
            100% { transform: translateY(0px) translateX(0px) rotate(360deg); }
        }
        
        @media (max-height: 700px) {
            .card { padding: 22px; margin: 12px 0; }
            .btn { padding: 16px 24px; font-size: 16px; }
            h1 { font-size: 30px; }
            h2 { font-size: 22px; }
        }
        
        @media (max-height: 600px) {
            .card { padding: 18px; margin: 8px 0; }
            .btn { padding: 14px 20px; font-size: 15px; }
            h1 { font-size: 26px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tela Inicial -->
        <div id="welcome-screen" class="card">
            <div class="install-icon">👓</div>
            <h1>Configurador de Óculos</h1>
            <p style="text-align: center; margin-bottom: 30px; opacity: 0.9; font-size: 17px;">
                Encontre a lente perfeita através de perguntas simples
            </p>
            
            <div class="install-guide">
                <h3 style="margin-bottom: 12px; color: #5AC8FA;">📱 Como instalar no iPhone</h3>
                <p style="font-size: 15px; line-height: 1.4;">
                    1. Toque no botão de <strong>Compartilhar</strong> no Safari<br>
                    2. Role para baixo e toque em <strong>"Adicionar à Tela de Início"</strong><br>
                    3. Confirme tocando em <strong>"Adicionar"</strong><br>
                    4. O app aparecerá na sua tela inicial!
                </p>
            </div>

            <button class="btn" onclick="startQuestions()">🔍 Começar Configuração</button>
            <button class="btn-outline btn" onclick="showAllLenses()">👀 Ver Todas as Lentes</button>
            <button class="btn-outline btn" onclick="showEditor()">✏️ Editar Preços</button>
            <button class="btn-outline btn" onclick="downloadStandalone()">⬇️ Baixar App Offline</button>
        </div>

        <!-- Tela de Perguntas -->
        <div id="question-screen" class="hidden">
            <div class="back-btn">
                <button class="btn-outline btn" onclick="goBack()">← Voltar</button>
            </div>
            <div class="card">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
                <h2 id="question-text"></h2>
                <div id="question-options"></div>
            </div>
        </div>

        <!-- Tela de Resultados -->
        <div id="results-screen" class="hidden">
            <div class="back-btn">
                <button class="btn-outline btn" onclick="startOver()">🏠 Nova Busca</button>
            </div>
            <div class="card">
                <h2>Lentes Encontradas</h2>
                <div id="results-list"></div>
            </div>
        </div>

        <!-- Editor de Preços -->
        <div id="editor-screen" class="hidden">
            <div class="back-btn">
                <button class="btn-outline btn" onclick="backToWelcome()">← Voltar</button>
            </div>
            <div class="card">
                <h2>Editor de Preços</h2>
                <div id="lens-list"></div>
                <button class="btn" onclick="addNewLens()">➕ Adicionar Nova Lente</button>
            </div>
        </div>
    </div>

    <script>
        // Todas as 43 lentes da planilha PRECIFICAÇÃO_REAL
        let lensData = [
            {id: 1, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -6,00 a +4,00 / Cil. -0,25 a -2,00", espessura: "1.56", precoVista: "R$ 399,00", parcela3x: "R$ 159,60", parcela6x: "R$ 89,77", parcela10x: "R$ 65,84"},
            {id: 2, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -6,00 a +6,00 / Cil. -2,25 a -4,00", espessura: "1.56", precoVista: "R$ 499,00", parcela3x: "R$ 199,60", parcela6x: "R$ 112,27", parcela10x: "R$ 82,34"},
            {id: 3, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +4,00 / Cil. -4,25 a -6,00", espessura: "1.56", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 4, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: true, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +4,00 / Cil. -0,25 a -2,00", espessura: "1.56", precoVista: "R$ 499,00", parcela3x: "R$ 199,60", parcela6x: "R$ 112,27", parcela10x: "R$ 82,34"},
            {id: 5, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: true, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +4,00 / Cil. -2,25 a -4,00", espessura: "1.56", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 6, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: false, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -6,00 a +4,00 / Cil. -0,25 a -2,00", espessura: "1.56", precoVista: "R$ 499,00", parcela3x: "R$ 199,60", parcela6x: "R$ 112,27", parcela10x: "R$ 82,34"},
            {id: 7, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: false, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +4,00 / Cil. -2,25 a -4,00", espessura: "1.56", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 8, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: true, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +2,00 / Cil. -0,25 a -2,00", espessura: "1.56", precoVista: "R$ 699,00", parcela3x: "R$ 279,60", parcela6x: "R$ 157,28", parcela10x: "R$ 115,33"},
            {id: 9, nome: "LT CR-39", incolor: false, antireflexo: true, fotosensivel: true, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +2,00 / Cil. -2,25 a -4,00", espessura: "1.56", precoVista: "R$ 799,00", parcela3x: "R$ 319,60", parcela6x: "R$ 179,78", parcela10x: "R$ 131,83"},
            {id: 10, nome: "LT POLI", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +4,00 / Cil. -0,25 a -2,00", espessura: "1.59", precoVista: "R$ 499,00", parcela3x: "R$ 199,60", parcela6x: "R$ 112,27", parcela10x: "R$ 82,34"},
            {id: 11, nome: "LT POLI", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -5,00 a +4,00 / Cil. -0,25 a -2,00", espessura: "1.59", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 12, nome: "LT POLI", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -2,00 a +3,00 / Cil. -2,25 a -4,00", espessura: "1.59", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 13, nome: "LT POLI HAYTEK", incolor: false, antireflexo: true, fotosensivel: true, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +2,00 / Cil. -0,25 a -2,00", espessura: "1.59", precoVista: "R$ 799,00", parcela3x: "R$ 319,60", parcela6x: "R$ 179,78", parcela10x: "R$ 131,83"},
            {id: 14, nome: "LT POLI HAYTEK", incolor: false, antireflexo: true, fotosensivel: true, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +2,00 / Cil. -2,25 a -4,00", espessura: "1.59", precoVista: "R$ 899,00", parcela3x: "R$ 359,60", parcela6x: "R$ 202,28", parcela10x: "R$ 148,33"},
            {id: 15, nome: "LT POLI", incolor: false, antireflexo: true, fotosensivel: false, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -6,00 a +4,00 / Cil. -0,25 a -2,00", espessura: "1.59", precoVista: "R$ 899,00", parcela3x: "R$ 359,60", parcela6x: "R$ 202,28", parcela10x: "R$ 148,33"},
            {id: 16, nome: "LT POLI", incolor: false, antireflexo: true, fotosensivel: false, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -6,00 a +4,00 / Cil. -2,25 a -4,00", espessura: "1.59", precoVista: "R$ 999,00", parcela3x: "R$ 399,60", parcela6x: "R$ 224,78", parcela10x: "R$ 164,83"},
            {id: 17, nome: "LT TRANSITIONS", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -2,00 a +2,00 / Cil. -0,25 a -2,00", espessura: "1.50", precoVista: "R$ 899,00", parcela3x: "R$ 359,60", parcela6x: "R$ 202,28", parcela10x: "R$ 148,33"},
            {id: 18, nome: "LT ALTO INDICE ~ SHINEDUX", incolor: false, antireflexo: true, fotosensivel: false, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -10,00 a +7,00 / Esf. -6,00 a +6,00 / Cil. -4,00 Esf. -6,25 a -10,00 / Cil. -2,00", espessura: "1.61", precoVista: "R$ 999,00", parcela3x: "R$ 399,60", parcela6x: "R$ 224,78", parcela10x: "R$ 164,83"},
            {id: 19, nome: "LT ALTO INDICE - SHINEDUX", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -10,00 a +7,00 / Esf. -6,00 a +6,00 / Cil. -4,00 Esf. -6,25 a -10,00 / Cil. -2,00", espessura: "1.61", precoVista: "R$ 899,00", parcela3x: "R$ 359,60", parcela6x: "R$ 202,28", parcela10x: "R$ 148,33"},
            {id: 20, nome: "LT ALTO INDICE - SHINEDUX", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -3,00 a -15,00 / Esf. -3,00 a -10,00 / Cil. -4,00 Esf. -10,25 a -12,00 / Cil. -2,00", espessura: "1.67", precoVista: "R$ 1199,00", parcela3x: "R$ 479,60", parcela6x: "R$ 269,78", parcela10x: "R$ 197,83"},
            {id: 21, nome: "LT ALTO INDICE - SHINEDUX", incolor: false, antireflexo: true, fotosensivel: true, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -3,00 a -15,00 / Esf. -3,00 a -10,00 / Cil. -4,00 Esf. -10,25 a -12,00 / Cil. -2,00", espessura: "1.67", precoVista: "R$ 1399,00", parcela3x: "R$ 559,60", parcela6x: "R$ 314,78", parcela10x: "R$ 230,83"},
            {id: 22, nome: "LT ALTO INDICE", incolor: false, antireflexo: true, fotosensivel: true, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -10,00 a +6,00 / Esf. -8,00 a +6,00 / Cil. -4,00 Esf. -8,25 a -10,00 / Cil. -3,00", espessura: "1.67", precoVista: "R$ 1299,00", parcela3x: "R$ 519,60", parcela6x: "R$ 292,28", parcela10x: "R$ 214,33"},
            {id: 23, nome: "LT ALTO INDICE RESIDUAL VERDE", incolor: false, antireflexo: false, fotosensivel: false, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -10,00 a +6,00 / Cil. -0,25 a -4,00", espessura: "1.67", precoVista: "R$ 1299,00", parcela3x: "R$ 519,60", parcela6x: "R$ 292,28", parcela10x: "R$ 214,33"},
            {id: 24, nome: "LT ALTO INDICE RESIDUAL VERDE", incolor: false, antireflexo: false, fotosensivel: false, blueCut: true, tipo: "VISÃO SIMPLES", medidas: "Esf. -1,00 a -15,00 / Cil. -0,25 a -3,00", espessura: "1.74", precoVista: "R$ 1899,00", parcela3x: "R$ 759,60", parcela6x: "R$ 427,28", parcela10x: "R$ 313,34"},
            {id: 25, nome: "LT ULTRAX TRIVEX - HOYA", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +3,00 / Cil. -0,25 a -2,00", espessura: "1.53", precoVista: "R$ 999,00", parcela3x: "R$ 399,60", parcela6x: "R$ 224,78", parcela10x: "R$ 164,83"},
            {id: 26, nome: "LT ULTRAX TRIVEX TRANSITIONS - HOYA", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "VISÃO SIMPLES", medidas: "Esf. -4,00 a +3,00 / Cil. -0,25 a -2,00", espessura: "1.53", precoVista: "R$ 1299,00", parcela3x: "R$ 519,60", parcela6x: "R$ 292,28", parcela10x: "R$ 214,33"},
            {id: 27, nome: "LT CR-39 - MARRON / CINZA / BLACK / G-15", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "LENTES SOLARES", medidas: "CURVA 600", espessura: "70mm", precoVista: "R$ 199,00", parcela3x: "R$ 79,60", parcela6x: "R$ 44,77", parcela10x: "R$ 32,84"},
            {id: 28, nome: "LT CR-39 ~ DEGRADE - MARRON / CINZA / BLACK / G-15", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "LENTES SOLARES", medidas: "CURVA 600", espessura: "70mm", precoVista: "R$ 199,00", parcela3x: "R$ 79,60", parcela6x: "R$ 44,77", parcela10x: "R$ 32,84"},
            {id: 29, nome: "LT CR-39 - CINZA / MARRON /G-15", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "LENTES SOLARES", medidas: "CURVA 800", espessura: "70mm", precoVista: "R$ 199,00", parcela3x: "R$ 79,60", parcela6x: "R$ 44,77", parcela10x: "R$ 32,84"},
            {id: 30, nome: "LT POLARIZADA - CINZA / MARRON / G-15", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "LENTES SOLARES", medidas: "CURVA 600", espessura: "70mm", precoVista: "R$ 199,00", parcela3x: "R$ 79,60", parcela6x: "R$ 44,77", parcela10x: "R$ 32,84"},
            {id: 31, nome: "LT ESPELHADA - AZUL / VERMELHA / PRATA / GOLD", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "LENTES SOLARES", medidas: "CURVA 600", espessura: "70mm", precoVista: "R$ 399,00", parcela3x: "R$ 159,60", parcela6x: "R$ 89,77", parcela10x: "R$ 65,84"},
            {id: 32, nome: "LT POLI - MARRON / CINZA /G-15", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "LENTES SOLARES", medidas: "CURVA 600 / 800", espessura: "70mm", precoVista: "R$ 199,00", parcela3x: "R$ 79,60", parcela6x: "R$ 44,77", parcela10x: "R$ 32,84"},
            {id: 33, nome: "LT POLI - DEGRADE / CINZA / MARRON", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "LENTES SOLARES", medidas: "CURVA 600", espessura: "70mm", precoVista: "R$ 199,00", parcela3x: "R$ 79,60", parcela6x: "R$ 44,77", parcela10x: "R$ 32,84"},
            {id: 34, nome: "LT CRISTAL - G-15", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "LENTES SOLARES", medidas: "CURVA 600", espessura: "70mm", precoVista: "R$ 299,00", parcela3x: "R$ 119,60", parcela6x: "R$ 67,27", parcela10x: "R$ 49,34"},
            {id: 35, nome: "BF ULTEX / KRIPTOK ACABADO", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "BIFOCAIS CR-39", medidas: "ESF. 0,00/3,00 - AD: 1,00 a 3,00", espessura: "15mm", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 36, nome: "MF CR-39 - SHINEDUX", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "PROGRESSIVAS ACABADAS", medidas: "ESF. 0,00/2,00 - AD: 1,00 a 3,00", espessura: "18mm", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 37, nome: "MF CR-39 ~ FREE LINE / PRO LIFE", incolor: true, antireflexo: false, fotosensivel: false, blueCut: false, tipo: "PROGRESSIVAS ACABADAS", medidas: "ESF. 0,00/2,00 - AD: 1,00 a 3,00", espessura: "18mm", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 38, nome: "MF CR-39", incolor: false, antireflexo: true, fotosensivel: false, blueCut: false, tipo: "PROGRESSIVAS ACABADAS", medidas: "ESF. 0,00/3,00 - AD: 1,00 a 3,00", espessura: "14mm", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 39, nome: "MF CR-39 - SHINEDUX", incolor: false, antireflexo: false, fotosensivel: false, blueCut: true, tipo: "PROGRESSIVAS ACABADAS", medidas: "ESF. 0,00/3,00 - AD: 1,00 a 3,00", espessura: "14mm", precoVista: "R$ 699,00", parcela3x: "R$ 279,60", parcela6x: "R$ 157,28", parcela10x: "R$ 115,33"},
            {id: 40, nome: "MF CR-39", incolor: false, antireflexo: false, fotosensivel: true, blueCut: false, tipo: "PROGRESSIVAS ACABADAS", medidas: "ESF. 0,00/3,00 - AD: 1,00 a 3,00", espessura: "14mm", precoVista: "R$ 599,00", parcela3x: "R$ 239,60", parcela6x: "R$ 134,78", parcela10x: "R$ 98,84"},
            {id: 41, nome: "MF CR-39 - SHINEDUX", incolor: false, antireflexo: true, fotosensivel: true, blueCut: false, tipo: "PROGRESSIVAS ACABADAS", medidas: "ESF. 0,00/3,00 - AD: 1,00 a 3,00", espessura: "14mm", precoVista: "R$ 699,00", parcela3x: "R$ 279,60", parcela6x: "R$ 157,28", parcela10x: "R$ 115,33"},
            {id: 42, nome: "MF CR39 - AUDAX", incolor: false, antireflexo: true, fotosensivel: true, blueCut: false, tipo: "PROGRESSIVAS ACABADAS", medidas: "ESF. 0,00/3,00 - AD: 1,00 a 3,00", espessura: "14mm", precoVista: "R$ 899,00", parcela3x: "R$ 359,60", parcela6x: "R$ 202,28", parcela10x: "R$ 148,33"},
            {id: 43, nome: "MF POLICARBONATO - SHINEDUX", incolor: false, antireflexo: false, fotosensivel: false, blueCut: true, tipo: "PROGRESSIVAS ACABADAS", medidas: "ESF. 0,00/2,00 - AD: 1,00 a 3,00", espessura: "14mm", precoVista: "R$ 1199,00", parcela3x: "R$ 479,60", parcela6x: "R$ 269,78", parcela10x: "R$ 197,83"}
        ];

        const questions = [
            {text: "É incolor?", key: "incolor", options: [{label: "SIM", value: true}, {label: "NÃO", value: false}]},
            {text: "Tem antirreflexo?", key: "antireflexo", options: [{label: "SIM", value: true}, {label: "NÃO", value: false}]},
            {text: "É fotossensível?", key: "fotosensivel", options: [{label: "SIM", value: true}, {label: "NÃO", value: false}]},
            {text: "Tem blue cut?", key: "blueCut", options: [{label: "SIM", value: true}, {label: "NÃO", value: false}]}
        ];

        let currentQuestion = 0;
        let answers = {};

        // Carregar dados salvos
        function loadData() {
            const saved = localStorage.getItem('lensData');
            if (saved) lensData = JSON.parse(saved);
        }

        // Salvar dados
        function saveData() {
            localStorage.setItem('lensData', JSON.stringify(lensData));
        }

        // Mostrar tela
        function showScreen(screenId) {
            document.querySelectorAll('[id$="-screen"]').forEach(s => s.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
        }

        // Iniciar perguntas
        function startQuestions() {
            currentQuestion = 0;
            answers = {};
            showScreen('question-screen');
            showQuestion();
        }

        // Mostrar pergunta atual
        function showQuestion() {
            const q = questions[currentQuestion];
            document.getElementById('question-text').textContent = q.text;
            
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';

            const optionsDiv = document.getElementById('question-options');
            optionsDiv.innerHTML = '';
            
            q.options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.textContent = option.label;
                btn.style.cssText = '-webkit-tap-highlight-color: transparent; touch-action: manipulation;';
                
                // Event listeners para iOS
                btn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    this.style.transform = 'scale(0.95)';
                }, { passive: false });
                
                btn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    this.style.transform = 'scale(1)';
                    setTimeout(() => answerQuestion(option.value), 100);
                }, { passive: false });
                
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    answerQuestion(option.value);
                });
                
                optionsDiv.appendChild(btn);
            });
        }

        // Responder pergunta
        function answerQuestion(answer) {
            const q = questions[currentQuestion];
            answers[q.key] = answer;
            
            currentQuestion++;
            if (currentQuestion < questions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        // Voltar pergunta
        function goBack() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            } else {
                showScreen('welcome-screen');
            }
        }

        // Função para calcular valor total das parcelas
        function calculateTotal(parcelaValue, numParcelas) {
            const value = parseFloat(parcelaValue.replace('R$', '').replace(',', '.').trim());
            const total = value * numParcelas;
            return `R$ ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        // Mostrar resultados
        function showResults() {
            const filtered = lensData.filter(lens => {
                return Object.keys(answers).every(key => lens[key] === answers[key]);
            });

            const resultsDiv = document.getElementById('results-list');
            resultsDiv.innerHTML = '';

            if (filtered.length === 0) {
                resultsDiv.innerHTML = '<p style="text-align: center; font-size: 18px; opacity: 0.8;">Nenhuma lente encontrada com essas características.</p>';
            } else {
                filtered.forEach(lens => {
                    const card = document.createElement('div');
                    card.className = 'lens-card';
                    
                    const features = [];
                    if (lens.incolor) features.push('Incolor');
                    if (lens.antireflexo) features.push('Antirreflexo');
                    if (lens.fotosensivel) features.push('Fotossensível');
                    if (lens.blueCut) features.push('Blue Cut');

                    const total3x = calculateTotal(lens.parcela3x, 3);
                    const total6x = calculateTotal(lens.parcela6x, 6);
                    const total10x = calculateTotal(lens.parcela10x, 10);

                    card.innerHTML = `
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">${lens.nome}</h3>
                        ${lens.tipo ? `<div style="margin: 10px 0;"><span style="background: #dbeafe; color: #1e40af; padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: bold;">${lens.tipo}</span></div>` : ''}
                        <div class="features">
                            ${features.map(f => `<span class="feature">${f}</span>`).join('')}
                        </div>
                        <p style="font-size: 14px; opacity: 0.8; margin: 8px 0;"><small>${lens.medidas} - ${lens.espessura}</small></p>
                        <div class="price">${lens.precoVista}</div>
                        <div style="margin: 16px 0; font-size: 15px;">
                            <div style="margin: 10px 0; display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <span>3x de ${lens.parcela3x}</span>
                                <span style="color: #5AC8FA; font-weight: 600;">Total: ${total3x}</span>
                            </div>
                            <div style="margin: 10px 0; display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <span>6x de ${lens.parcela6x}</span>
                                <span style="color: #5AC8FA; font-weight: 600;">Total: ${total6x}</span>
                            </div>
                            <div style="margin: 10px 0; display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <span>10x de ${lens.parcela10x}</span>
                                <span style="color: #5AC8FA; font-weight: 600;">Total: ${total10x}</span>
                            </div>
                        </div>
                        <p style="font-size: 12px; opacity: 0.7; margin-top: 10px; text-align: center; color: #5AC8FA;">
                            Valor à vista: <strong>${lens.precoVista}</strong>
                        </p>
                    `;
                    resultsDiv.appendChild(card);
                });
            }

            showScreen('results-screen');
        }

        // Mostrar editor
        function showEditor() {
            renderLensList();
            showScreen('editor-screen');
        }

        // Renderizar lista de lentes no editor
        function renderLensList() {
            const listDiv = document.getElementById('lens-list');
            listDiv.innerHTML = '';

            lensData.forEach((lens, index) => {
                const card = document.createElement('div');
                card.className = 'lens-card';
                card.innerHTML = `
                    <input class="editor-input" value="${lens.nome}" onchange="updateLens(${index}, 'nome', this.value)" placeholder="Nome">
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0;">
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 16px;"><input type="checkbox" ${lens.incolor ? 'checked' : ''} onchange="updateLens(${index}, 'incolor', this.checked)"> Incolor</label>
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 16px;"><input type="checkbox" ${lens.antireflexo ? 'checked' : ''} onchange="updateLens(${index}, 'antireflexo', this.checked)"> Antirreflexo</label>
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 16px;"><input type="checkbox" ${lens.fotosensivel ? 'checked' : ''} onchange="updateLens(${index}, 'fotosensivel', this.checked)"> Fotossensível</label>
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 16px;"><input type="checkbox" ${lens.blueCut ? 'checked' : ''} onchange="updateLens(${index}, 'blueCut', this.checked)"> Blue Cut</label>
                    </div>

                    <label style="font-size: 14px; color: #5AC8FA; margin-top: 12px; display: block;">Medidas:</label>
                    <textarea class="editor-input" rows="2" onchange="updateLens(${index}, 'medidas', this.value)" placeholder="Ex: Esf. -6,00 a +4,00 / Cil. -0,25 a -2,00">${lens.medidas}</textarea>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0;">
                        <input class="editor-input" value="${lens.precoVista}" onchange="updateLens(${index}, 'precoVista', this.value)" placeholder="Preço à Vista">
                        <input class="editor-input" value="${lens.parcela3x}" onchange="updateLens(${index}, 'parcela3x', this.value)" placeholder="3x">
                    </div>

                    <button class="btn-outline" onclick="removeLens(${index})" style="margin-top: 12px;">🗑️ Remover</button>
                `;
                listDiv.appendChild(card);
            });
        }

        // Atualizar lente
        function updateLens(index, field, value) {
            lensData[index][field] = value;
            saveData();
        }

        // Remover lente
        function removeLens(index) {
            if (confirm('Tem certeza que deseja remover esta lente?')) {
                lensData.splice(index, 1);
                saveData();
                renderLensList();
            }
        }

        // Adicionar nova lente
        function addNewLens() {
            const newId = Math.max(...lensData.map(l => l.id)) + 1;
            lensData.push({
                id: newId,
                nome: "Nova Lente",
                incolor: false,
                antireflexo: false,
                fotosensivel: false,
                blueCut: false,
                tipo: "VISÃO SIMPLES",
                medidas: "Esf. 0,00 / Cil. 0,00",
                espessura: "1.50",
                precoVista: "R$ 0,00",
                parcela3x: "R$ 0,00",
                parcela6x: "R$ 0,00",
                parcela10x: "R$ 0,00"
            });
            saveData();
            renderLensList();
        }

        // Mostrar todas as lentes
        function showAllLenses() {
            currentAnswers = {};
            currentStep = 0;
            showResults(lensData);
        }

        // Voltar para início
        function startOver() {
            showScreen('welcome-screen');
        }

        function backToWelcome() {
            showScreen('welcome-screen');
        }

        // Download da versão standalone
        function downloadStandalone() {
            const content = document.documentElement.outerHTML;
            const blob = new Blob([content], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'configurador-oculos-iphone.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Corrigir event handlers para iOS
        function setupIOSButtons() {
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                // Remover event handlers antigos
                btn.onclick = null;
                
                // Adicionar event listeners específicos para iOS
                btn.addEventListener('touchstart', function(e) {
                    this.style.transform = 'scale(0.95)';
                }, { passive: true });
                
                btn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    this.style.transform = 'scale(1)';
                    
                    // Executar ação baseada no texto do botão
                    const text = this.textContent.trim();
                    setTimeout(() => {
                        if (text.includes('Começar Configuração')) {
                            startQuestions();
                        } else if (text.includes('Ver Todas as Lentes')) {
                            showAllLenses();
                        } else if (text.includes('Editar Preços')) {
                            showEditor();
                        } else if (text.includes('Baixar App Offline')) {
                            downloadStandalone();
                        } else if (text.includes('Voltar')) {
                            goBack();
                        } else if (text.includes('Nova Busca')) {
                            startOver();
                        }
                    }, 100);
                }, { passive: false });
                
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Backup para navegadores desktop
                });
            });
        }

        // Inicializar
        loadData();
        
        // Configurar botões para iOS após carregar
        document.addEventListener('DOMContentLoaded', setupIOSButtons);
        setTimeout(setupIOSButtons, 500);

        // Prevenir zoom duplo-toque no iOS
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>